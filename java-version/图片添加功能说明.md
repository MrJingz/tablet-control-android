# 图片添加功能说明

## 功能概述

已成功实现了"添加图片"功能，用户可以点击"添加图片"按钮，从`java-version\USERDATA\picture`目录中选择图片文件，并在画布中生成图片组件。

## 功能特性

### 1. 文件选择限制
- **路径限制**: 只能选择`USERDATA/picture`目录下的图片文件
- **文件格式支持**: 支持 jpg, jpeg, png, gif, bmp, webp 格式
- **安全验证**: 系统会验证选择的文件是否在指定目录下

### 2. 图片组件特性
- **自动缩放**: 根据图片原始宽高比自动计算合适的显示尺寸
- **最大尺寸限制**: 图片组件最大显示尺寸为 200x150 像素
- **最小尺寸保证**: 确保图片组件最小尺寸为 60x40 像素
- **居中显示**: 新添加的图片组件会自动放置在画布中心

### 3. 交互功能
- **选中功能**: 点击图片组件可以选中它
- **拖拽移动**: 可以拖拽图片组件在画布中移动位置
- **相对定位**: 使用相对位置系统，支持跨分辨率兼容

## 使用方法

### 步骤1: 准备图片文件
1. 将要使用的图片文件放入`java-version\USERDATA\picture`目录
2. 确保图片格式为支持的格式（jpg, png, gif, bmp, webp等）

### 步骤2: 创建或选择页面
1. 启动应用程序
2. 确保已创建或选择了一个页面（如果没有页面，系统会提示先创建页面）

### 步骤3: 添加图片
1. 点击界面上的"添加图片"按钮
2. 在弹出的文件选择对话框中，浏览`USERDATA/picture`目录
3. 选择要添加的图片文件
4. 点击"打开"确认选择

### 步骤4: 操作图片组件
1. 图片组件会自动添加到画布中心
2. 点击图片组件可以选中它
3. 拖拽图片组件可以移动位置
4. 图片组件的位置会自动保存

## 技术实现

### 核心方法
- `addImageToCanvas()`: 主要的图片添加方法
- `createImageComponent()`: 创建图片组件
- `createRelativePosition()`: 创建相对位置数据
- `addInstanceMouseListeners()`: 添加鼠标交互监听器

### 关键特性
- **高质量缩放**: 使用`Image.SCALE_SMOOTH`进行高质量图片缩放
- **相对定位系统**: 使用百分比定位，支持不同分辨率
- **事件处理**: 完整的鼠标点击、拖拽事件处理
- **边界检测**: 防止图片组件被拖拽到画布外

## 错误处理

### 常见错误及解决方案

1. **"请先创建或选择一个页面"**
   - 原因: 没有当前活动页面
   - 解决: 先创建或选择一个页面

2. **"只能选择 USERDATA/picture 目录下的图片文件"**
   - 原因: 选择了其他目录的文件
   - 解决: 确保选择的文件在正确的目录下

3. **"添加图片失败"**
   - 原因: 图片文件损坏或格式不支持
   - 解决: 检查图片文件是否完整，格式是否支持

## 目录结构

```
java-version/
├── USERDATA/
│   ├── picture/          # 图片文件目录
│   │   ├── 1.jpg
│   │   ├── 2.jpg
│   │   ├── *.png
│   │   └── *.webp
│   ├── appearance/       # 按钮样式目录
│   └── background/       # 背景图片目录
└── src/
    └── main/
        └── java/
            └── com/feixiang/tabletcontrol/
                └── SwingTabletControlApp.java
```

## 注意事项

1. **文件路径**: 确保图片文件放在正确的目录下
2. **文件格式**: 使用支持的图片格式
3. **文件大小**: 建议使用适中大小的图片文件，避免过大影响性能
4. **页面管理**: 添加图片前确保有活动页面
5. **保存功能**: 图片组件的位置和属性会自动保存到项目数据中

## 扩展功能

未来可以考虑添加的功能：
- 图片组件的缩放功能
- 图片组件的旋转功能
- 图片组件的透明度调整
- 图片组件的层级管理
- 批量图片添加功能
